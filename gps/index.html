<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SS Services - GPS Camera Pro</title>

<meta name="description" content="Use GPS Camera Pro by SS Services to Capture GPS Images and Save them directly as Image or PDF, a free secure productivity tool from SSPL in Karnataka.">
  <meta name="keywords" content="GPS Camera, GPS Camera Pro, claims investigations Karnataka, PDF tools online free, GPStool, 3ctool image to PDF, PDF compression, SS Services, Sarvasiddhanta Services Private Limited, SSPL, image conversion">
  <meta name="author" content="Sarvasiddhanta Services Private Limited">

  <meta name="google-adsense-account" content="ca-pub-2931901961774543">    
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="canonical" href="https://ss-services.co.in/gpstool">
  <!-- Schema Markup -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "GPStool",
    "operatingSystem": "Web",
    "applicationCategory": "Utility",
    "description": "GPStool is a free online tool to capture images with geotagging, and convert images to PDF.",
    "url": "https://ss-services.co.in/gpstool",
    "author": {
      "@type": "Organization",
      "name": "Sarvasiddhanta Services Private Limited"
    }
  }
  </script>
 


<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.13.216/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/exif-js/2.3.0/exif.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
 <script src="/access/login.js"></script>  
</head>

<body>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      box-sizing: border-box;
      background: linear-gradient(to bottom right, #e6f2ff, #ffffff);
      color: #333;
    }

    .brand {
      display: flex;
      align-items: center;
      padding: 20px 40px;
      background-color: #e6f2ff;
    }

    .brand img {
      width: 60px;
      height: auto;
      max-height: 60px;
      margin-right: 20px;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      object-fit: contain;
    }

    .brand h1 {
      font-size: 1.6em;
      margin: 0;
      font-weight: 600;
      line-height: 1.2;
      text-align: left;
    }

    .navigation {
      text-align: left;
      padding: 20px 40px;
    }

    .back-link {
      font-size: 16px;
      font-weight: bold;
      color: #333;
      text-decoration: underline;
      display: inline-block;
      margin-bottom: 20px;
    }

    @media (max-width: 600px) {
      .brand {
        flex-direction: column;
        align-items: center;
        text-align: center;
      }

      .brand img {
        margin-right: 0;
        margin-bottom: 10px;
        width: 50px;
        max-height: 50px;
      }

      .brand h1 {
        font-size: 1.4em;
        text-align: center;
      }

      .navigation {
        text-align: center;
        padding: 10px 20px;
      }
    }
  </style>

  <div class="brand">
    <img src="New Logo.jpg" alt="SSPL logo">
    <h1>SARVASIDDHANTA SERVICES PRIVATE LIMITED</h1>
  </div>

  <div class="navigation">
    <a href="https://ss-services.co.in" class="back-link">‚Üê Back to Main Page</a>
    <br>
  </div>
</body>

<!-- SECTION: GPS Camera Tool -->
<section>
 <title>Camera with GPS & Address Overlay</title>
<style>
        body {
            text-align: center;
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        h2 {
            margin-top: 20px;
            color: #333;
        }

        .camera-btn {
            display: inline-block;
            cursor: pointer;
            padding: 15px;
            border-radius: 50%;
            background-color: #007bff;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: 0.3s;
        }

        .camera-btn:hover {
            background-color: #0056b3;
        }

        .camera-btn img {
            width: 50px;
            height: 50px;
            filter: invert(1);
        }

        #cameraInput {
            display: none;
        }

      .canvas-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px; /* Consistent vertical spacing between canvases */
  margin-top: 20px;
  padding: 10px;
}

        .downloadLink,
        .checkbox {
            display: inline-block;
            font-size: 16px;
            margin-top: 15px;
            color: #007bff;
            text-decoration: underline;
            cursor: pointer;
        }

        .downloadLink:hover,
        #pdfDownloadLink:hover {
            color: #0056b3;
        }

        #mergeToPDF {
            display: none;
            font-size: 16px;
            margin-top: 15px;
            color: #333;
            cursor: pointer;
        }

        #mergeToPDF:hover {
            color: #0056b3;
        }
    </style>

<div class="container" style="max-width: 800px; margin: auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.08); text-align: center;">
  <h1 style="margin-bottom: 10px; font-size: 2em; color: #222;">üßø GPS CAMERA PRO</h1>
  <p style="font-size: 1.2em; color: #555; margin-bottom: 20px;"><em>No app download. Zero ads. Just clarity.</em></p>

  <h2 style="color: #FF5733; margin-top: 30px;"><strong>üì∏ New Features Alert</strong></h2>
  <ul style="list-style: none; padding: 0; font-size: 1.1em; color: #333;">
    <li style="margin: 10px 0; color: #33C1FF;">‚úÖ Capture multiple images in one go</li>
    <li style="margin: 10px 0; color: #33C1FF;">‚úÖ Merge them into a single PDF with just one click</li>
    <li style="margin: 10px 0; color: #33C1FF;">‚úÖ Upload them directly to respective case folders</li>
      
</ul>
</div>


<p><strong>Developed by SSPL</strong></p>
<p><strong><i>*Note: Please enable Location Tag on your Camera to ensure GPS display</i></strong></p>

<p><strong> If you are an Employee of SSPL, use your Login to access the folders where you would like to store the Images / Files</strong><p>
<p><strong> If you are a visitor / guest, directly click on Camera Icon and you can download the Images/ Files to your device</strong><p>

<!-- üîê Login Gate -->
<div style="margin-top: 30px; margin-bottom: 25px; padding: 20px; background-color: #f0f4f8; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
  <label for="loginInput" style="font-weight: 600; font-size: 1.1em; color: #333;">üîê Enter Passphrase</label><br>
  <input type="password" id="loginInput" placeholder="Your key of trust" style="width: 60%; padding: 10px; margin-top: 8px; margin-bottom: 12px; border: 1px solid #ccc; border-radius: 6px; font-size: 1em;" /><br>
  <button onclick="attemptLogin()" style="background-color: #4a90e2; color: white; padding: 10px 20px; border: none; border-radius: 6px; font-size: 1em; cursor: pointer; transition: background-color 0.3s ease;">
    Login
  </button>
</div>

<!-- üîì Case Selector (locked until login) -->
<div style="margin-bottom: 25px; padding: 20px; width = 800px: background-color: #fefefe; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
  <label for="caseSelector" style="font-weight: 600; font-size: 1.1em; color: #333;">üìÇ Select Case</label>
  <select id="caseSelector" disabled style="width: 60%; padding: 10px; margin-top: 8px; border: 1px solid #ccc; border-radius: 6px; font-size: 1em;">
    <option value="">-- Choose a case --</option>
  </select>
</div>

<script src="/access/login.js"></script>

<label for="cameraInput" class="camera-btn" style="display: inline-block; margin-bottom: 20px;">
  <img src="https://cdn-icons-png.flaticon.com/512/685/685655.png" alt="Camera">
</label><br>

<div style="margin-bottom: 15px; display: flex; flex-direction: column; align-items: center;">
  <label for="gpsSlider" style="font-weight: bold; margin-bottom: 5px;">GPS Overlay:</label>
  <div style="display: flex; align-items: center; gap: 8px;">
    <span style="font-size: 0.9em; color: #555;">Off</span>
    <input type="range" id="gpsSlider" min="0" max="1" step="1" value="1" style="width: 100px; accent-color: #003366;">
    <span style="font-size: 0.9em; color: #555;">On</span>
  </div>
</div>

    <input type="file" id="cameraInput" accept="image/*">
    <center><div class="canvas-container" id="canvasContainer"></div></center>
<center style="margin-top: 20px;">
  <button id="uploadSingleBtn" style="display:none;" onclick="uploadSingleImage()">Convert to PDF and Upload to Drive</button>
  <button id="mergeUploadBtn" style="display:none;" onclick="mergeSelectedImages()">Convert, Merge and Upload to Drive</button>
</center>    

  <!-- GPS Camera JS -->
  <script>
        console.log("Page loaded and script running...");
        let uploadedImages = [];
        let gpsCoordinates = "Fetching GPS...";
        let address = "Fetching Address...";
        let imageCounter = 1;
        document.getElementById("cameraInput").addEventListener("change", function (event) {
            const file = event.target.files[0];
            if (!file) return;

            console.log("Image selected:", file.name);
            const reader = new FileReader();
            reader.onload = function (e) {
                let uploadedImage = new Image();
                uploadedImage.onload = function () {
                    readEXIFGPS(file, function (exifDate) {
                        drawImageWithOverlay(uploadedImage, exifDate);
                    });
                };
                uploadedImage.src = e.target.result;
            };
            reader.readAsDataURL(file);
        });

        function readEXIFGPS(file, callback) {
    let alreadyCalled = false;
    function safeCallback(date) {
        if (alreadyCalled) return;
        alreadyCalled = true;
        callback(date);
    }

    EXIF.getData(file, function () {
        const lat = EXIF.getTag(this, "GPSLatitude");
        const lon = EXIF.getTag(this, "GPSLongitude");
        const latRef = EXIF.getTag(this, "GPSLatitudeRef") || "N";
        const lonRef = EXIF.getTag(this, "GPSLongitudeRef") || "E";

        let exifDate = EXIF.getTag(this, "DateTimeOriginal");
        if (exifDate) {
            exifDate = exifDate.replace(/:/g, "-").replace(" ", " @ ");
        } else {
            exifDate = new Date().toLocaleString();
        }

        console.log("EXIF Date Extracted:", exifDate);

        if (lat && lon) {
            const latitude = convertToDecimal(lat, latRef);
            const longitude = convertToDecimal(lon, lonRef);
            gpsCoordinates = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
            fetchAddress(latitude, longitude, exifDate, safeCallback);
        } else {
            gpsCoordinates = "GPS not found!";
            address = "Address not available";
            safeCallback(exifDate);
        }
    });
}

        function convertToDecimal(coord, ref) {
            let decimal = coord[0] + coord[1] / 60 + coord[2] / 3600;
            return (ref === "S" || ref === "W") ? -decimal : decimal;
        }

        function fetchAddress(lat, lon, exifDate, callback) {
            fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`)
                .then(response => response.json())
                .then(data => {
                    address = data.display_name || "Address not found";
                    callback(exifDate); // Use extracted EXIF date
                })
                .catch(() => {
                    address = "Failed to fetch address";
                    callback(exifDate); // Ensure EXIF date is used even on failure
                });
        }
function drawImageWithOverlay(image, exifDate) {
    const canvasContainer = document.getElementById("canvasContainer");

    // Create a new canvas for each image
    const canvas = document.createElement("canvas");
    canvasContainer.appendChild(canvas);
    const ctx = canvas.getContext("2d");

    let maxWidth = window.innerWidth * 0.9;
    let scaleFactor = maxWidth / image.width;
    canvas.width = image.width * scaleFactor;
    canvas.height = image.height * scaleFactor;
    ctx.drawImage(image, 0, 0, canvas.width, canvas.height);

    ctx.imageSmoothingEnabled = true;
    ctx.imageSmoothingQuality = "high";

    const includeGPS = document.getElementById('gpsSlider').value === "1";

if (includeGPS) {
    ctx.fillStyle = "black";
    ctx.fillRect(0, canvas.height - 120, canvas.width, 100);
    ctx.fillStyle = "yellow";
    ctx.font = "14px Arial";


    let addressLines = splitText(ctx, address, canvas.width - 40);
    ctx.fillText(`Date: ${exifDate}`, 20, canvas.height - 110);
    ctx.fillText(`GPS: ${gpsCoordinates}`, 20, canvas.height - 90);
    addressLines.forEach((line, index) => {
        ctx.fillText(line, 20, canvas.height - 70 + index * 20);
    });
}

    // Generate image URL and set the download link
    const imageData = canvas.toDataURL("image/png");
    let fileName = `GPS_Photo_${imageCounter}.png`;

    const downloadLink = document.createElement("a");
    downloadLink.href = imageData;
    downloadLink.download = fileName;
    downloadLink.classList.add("downloadLink");
    downloadLink.textContent = `Download ${fileName}`;

    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.classList.add("checkbox");
    checkbox.id = `checkbox_${imageCounter}`;
    checkbox.value = imageCounter;
    checkbox.style.display = "inline";

checkbox.addEventListener('change', function () {
  const selectedCount = uploadedImages.filter(img => img.checkbox.checked).length;

  const singleBtn = document.getElementById("uploadSingleBtn");
  const mergeBtn = document.getElementById("mergeUploadBtn");

  if (selectedCount === 1) {
    singleBtn.style.display = "inline-block";
    mergeBtn.style.display = "none";
  } else if (selectedCount > 1) {
    singleBtn.style.display = "none";
    mergeBtn.style.display = "inline-block";
  } else {
    singleBtn.style.display = "none";
    mergeBtn.style.display = "none";
  }
});


// ‚úÖ Append elements to canvasContainer outside the event listener
canvasContainer.appendChild(checkbox);
canvasContainer.appendChild(downloadLink);

    // Call PDF function
    generatePDF(imageData, exifDate, imageCounter);

    // Add image data to the array
    uploadedImages.push({ imageData, fileName, checkbox });

    // Show merge to PDF button if 2 or more images are uploaded
    if (uploadedImages.length > 1) {
        document.getElementById("mergeToPDF").style.display = "block";
    }

    // Increment counter for next image
    imageCounter++;
}

function splitText(ctx, text, maxWidth) {
    let words = text.split(" ");
    let lines = [];
    let line = "";
    for (let word of words) {
        let testLine = line + word + " ";
        if (ctx.measureText(testLine).width > maxWidth) {
            lines.push(line);
            line = word + " ";
        } else {
            line = testLine;
        }
    }
    lines.push(line);
    return lines;
}

function generatePDF(imageData, exifDate, count) {
    const { jsPDF } = window.jspdf;

    const img = new Image();
    img.src = imageData;
    img.onload = function () {
        const pdf = new jsPDF(); // Default A4 size
        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();

        const imgRatio = img.width / img.height;
        const pageRatio = pageWidth / pageHeight;

        let imgWidth, imgHeight;

        if (imgRatio > pageRatio) {
            imgWidth = pageWidth;
            imgHeight = pageWidth / imgRatio;
        } else {
            imgHeight = pageHeight;
            imgWidth = pageHeight * imgRatio;
        }

        const x = (pageWidth - imgWidth) / 2;
        const y = (pageHeight - imgHeight) / 2;

        pdf.addImage(img, "PNG", x, y, imgWidth, imgHeight); // Use PNG if imageData is PNG

        const pdfFileName = `GPS_Photo_${count}.pdf`;
        const pdfBlob = pdf.output("blob");
        const pdfURL = URL.createObjectURL(pdfBlob);

        const pdfDownloadLink = document.createElement("a");
        pdfDownloadLink.href = pdfURL;
        pdfDownloadLink.download = pdfFileName;
        pdfDownloadLink.classList.add("downloadLink");
        pdfDownloadLink.textContent = `Download ${pdfFileName}`;
        document.getElementById("canvasContainer").appendChild(pdfDownloadLink);

        console.log(`PDF created for ${pdfFileName}`);
    };
}
function dataURItoBlob(dataURI) {
    const byteString = atob(dataURI.split(',')[1]);
    const mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];

    const ab = new ArrayBuffer(byteString.length);
    const ia = new Uint8Array(ab);
    for (let i = 0; i < byteString.length; i++) {
        ia[i] = byteString.charCodeAt(i);
    }

    return new Blob([ab], { type: mimeString });
}

function blobToBase64(blob) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onloadend = () => {
      const base64String = reader.result.split(',')[1]; // Remove data URL prefix
      resolve(base64String);
    };
    reader.onerror = reject;
    reader.readAsDataURL(blob);
  });
}

const fileCounters = {};
function mergeToPDF() {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();

  const selectedImages = uploadedImages.filter((image, index) => {
    const checkbox = document.getElementById(`checkbox_${index + 1}`);
    return checkbox && checkbox.checked;
  });

  const imageContainer = document.getElementById("imagePreview");
  if (imageContainer) {
    imageContainer.innerHTML = "";
    selectedImages.forEach((image, index) => {
      const imgElement = document.createElement("img");
      imgElement.src = image.imageData;
      imgElement.style.width = "100px";
      imgElement.style.margin = "5px";
      imgElement.alt = `Selected image ${index + 1}`;
      imageContainer.appendChild(imgElement);
    });
  }

  const imagePromises = selectedImages.map((image, index) => {
    return new Promise((resolve) => {
      const img = new Image();
      img.src = image.imageData;
      img.onload = function () {
        const pdfWidth = pdf.internal.pageSize.getWidth();
        const pdfHeight = pdf.internal.pageSize.getHeight();
        let imgWidth = img.width;
        let imgHeight = img.height;
        const aspectRatio = imgWidth / imgHeight;

        if (imgWidth > imgHeight) {
          imgWidth = pdfWidth;
          imgHeight = pdfWidth / aspectRatio;
          if (imgHeight > pdfHeight) {
            imgHeight = pdfHeight;
            imgWidth = pdfHeight * aspectRatio;
          }
        } else {
          imgHeight = pdfHeight;
          imgWidth = pdfHeight * aspectRatio;
          if (imgWidth > pdfWidth) {
            imgWidth = pdfWidth;
            imgHeight = pdfWidth / aspectRatio;
          }
        }

        if (index > 0) {
          pdf.addPage();
        }

        const x = (pdfWidth - imgWidth) / 2;
        const y = (pdfHeight - imgHeight) / 2;
        pdf.addImage(image.imageData, "JPEG", x, y, imgWidth, imgHeight);
        resolve();
      };
    });
  });

  Promise.all(imagePromises).then(() => {
    const pdfBlob = new Blob([pdf.output("arraybuffer")], { type: "application/pdf" });

   const selector = document.getElementById("caseSelector");
   const selectedFolderId = selector.value;
   const rawName = selector.selectedOptions[0].textContent.trim();
   const normalized = rawName.replace(/‚Äì/g, "-").replace(/\s*-\s*/g, "-");
   const parts = normalized.split("-");

let caseNumber = parts[0]?.trim() || "Unknown";
let caseName = parts[1]?.trim().replace(/\s+/g, "_") || "Unknown";

const baseKey = `${caseNumber}_${caseName}`;
fileCounters[baseKey] = (fileCounters[baseKey] || 0) + 1;

const suffix = fileCounters[baseKey] > 1 ? `-${fileCounters[baseKey] - 1}` : "";
const fileName = `${baseKey}_GPS_Report${suffix}.pdf`;

    if (!selectedFolderId) {
      alert("Please select a case before uploading.");
      return;
    }

    console.log("üìÑ PDF Blob size:", pdfBlob.size);
    console.log("üìÅ Selected folder ID:", selectedFolderId);
    console.log("üìÅ File name:", fileName);

    blobToBase64(pdfBlob).then(base64Data => {
      const payload = {
        folderId: selectedFolderId,
        fileName: fileName,
        base64: base64Data
      };

      console.log("üì¶ Base64 length:", base64Data.length);

      fetch("/upload-pdf", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      })
        .then(response => response.text())
        .then(result => {
          console.log("‚úÖ Upload success:", result);
          alert("‚úÖ PDF uploaded successfully to Drive.");
        })
        .catch(error => {
          console.error("‚ùå Upload failed:", error);
          alert("‚ùå Upload failed. Please try again.");
        });
    });
  }).catch(error => {
    console.error("‚ùå Error merging PDF:", error);
    alert("‚ùå PDF merge failed. Please check your images and try again.");
  });
}

function uploadSingleImage() {
  console.log("üü¢ uploadSingleImage triggered");

  const selected = uploadedImages.find(img => img.checkbox.checked);
  if (!selected) return;

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();

  const img = new Image();
  img.src = selected.imageData;

  img.onload = function () {
    const pageWidth = pdf.internal.pageSize.getWidth();
    const pageHeight = pdf.internal.pageSize.getHeight();

    const imgWidth = img.width;
    const imgHeight = img.height;

    const scale = Math.min(pageWidth / imgWidth, pageHeight / imgHeight);
    const scaledWidth = imgWidth * scale;
    const scaledHeight = imgHeight * scale;

    const x = (pageWidth - scaledWidth) / 2;
    const y = (pageHeight - scaledHeight) / 2;

    pdf.addImage(img, "JPEG", x, y, scaledWidth, scaledHeight);
    const blob = pdf.output("blob");

    const selector = document.getElementById("caseSelector");
    const folderId = selector.value;
    if (!folderId) {
      alert("Please select a case before uploading.");
      return;
    }

    blobToBase64(blob).then(base64Data => {
      fetch("/upload-pdf", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          folderId: folderId,
          fileName: selected.fileName.replace(/\.(jpg|jpeg|png)$/i, ".pdf"),
          base64: base64Data
        })
      })
      .then(res => res.text())
      .then(result => {
        console.log("‚úÖ Single image uploaded:", result);
        alert(`‚úÖ ${selected.fileName} uploaded as PDF.`);
      })
      .catch(err => {
        console.error("‚ùå Upload failed:", err);
        alert("‚ùå Upload failed. Please try again.");
      });
    });
  };
}

function mergeSelectedImages() {
  console.log("üü¢ mergeSelectedImages triggered");

  const selectedImages = uploadedImages.filter(img => img.checkbox.checked);
  if (selectedImages.length < 2) return;

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();

  let loadCount = 0;

  selectedImages.forEach((imgObj, index) => {
    const img = new Image();
    img.src = imgObj.imageData;

    img.onload = function () {
      const pageWidth = pdf.internal.pageSize.getWidth();
      const pageHeight = pdf.internal.pageSize.getHeight();

      const imgWidth = img.width;
      const imgHeight = img.height;

      const scale = Math.min(pageWidth / imgWidth, pageHeight / imgHeight);
      const scaledWidth = imgWidth * scale;
      const scaledHeight = imgHeight * scale;

      const x = (pageWidth - scaledWidth) / 2;
      const y = (pageHeight - scaledHeight) / 2;

      pdf.addImage(img, "PNG", x, y, scaledWidth, scaledHeight);

      if (index < selectedImages.length - 1) {
        pdf.addPage();
      }

      loadCount++;
      if (loadCount === selectedImages.length) {
        const blob = pdf.output("blob");

        const selector = document.getElementById("caseSelector");
        const folderId = selector.value;
        if (!folderId) {
          alert("Please select a case before uploading.");
          return;
        }

        blobToBase64(blob).then(base64Data => {
          fetch("/upload-pdf", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              folderId: folderId,
              fileName: "Merged_Images.pdf",
              base64: base64Data
            })
          })
          .then(res => res.text())
          .then(result => {
            console.log("‚úÖ Merged PDF uploaded:", result);
            alert("‚úÖ Merged PDF uploaded to Drive.");
          })
          .catch(err => {
            console.error("‚ùå Upload failed:", err);
            alert("‚ùå Upload failed. Please try again.");
          });
        });
      }
    };
  });
}

</script>
</section>
<!-- END SECTION: GPS Camera Tool --><br>



  <!-- Footer -->
  <footer>
    ¬© 2025 Sarvasiddhanta Services Private Limited (SSPL). All rights reserved.
  </footer>

</body>
</html>

